const assets = {
  filled: {
    solid:
      '<svg width="24" height="23" viewBox="0 0 24 23" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12.3455 0.214635L15.7552 7.12368C15.8112 7.23749 15.9196 7.31604 16.0451 7.33422L23.6697 8.44221C23.9857 8.48803 24.1119 8.87639 23.8832 9.0993L18.3661 14.4771C18.2752 14.5654 18.2338 14.6931 18.2552 14.8178L19.5578 22.4116C19.6116 22.7261 19.2814 22.9661 18.9989 22.8174L12.1793 19.232C12.0669 19.173 11.9331 19.173 11.8207 19.232L5.00114 22.8174C4.7186 22.9657 4.38842 22.7261 4.44224 22.4116L5.74477 14.8178C5.76623 14.6927 5.72477 14.5654 5.63386 14.4771L0.116813 9.0993C-0.111913 8.87639 0.0142679 8.48839 0.330266 8.44221L7.95494 7.33422C8.08039 7.31604 8.18875 7.23713 8.24475 7.12368L11.6545 0.214635C11.7956 -0.0715449 12.204 -0.0715449 12.3451 0.214635H12.3455Z" fill="#F3CC30"/><path d="M4.59206 21.5381L4.44224 22.4119C4.38842 22.7265 4.7186 22.9665 5.00114 22.8177L11.8207 19.2323C11.9331 19.1734 12.0669 19.1734 12.1793 19.2323L18.9989 22.8177C19.2814 22.9665 19.6116 22.7265 19.5578 22.4119L18.2552 14.8181C18.2338 14.6931 18.2752 14.5658 18.3661 14.4774L23.8832 9.09965C24.1119 8.87674 23.9857 8.48874 23.6697 8.44256L21.1159 8.07129C16.9854 15.484 10.6604 19.3868 4.59206 21.5381Z" fill="#EDBD31"/></svg>',
    "1star":
      '<svg width="26" height="24" viewBox="0 0 26 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12.9594 0.22531L16.5388 7.47797C16.5976 7.59745 16.7114 7.6799 16.8431 7.69899L24.8469 8.86208C25.1787 8.91018 25.3111 9.31785 25.071 9.55185L19.2796 15.1971C19.1841 15.2898 19.1406 15.4238 19.1631 15.5548L20.5305 23.5262C20.587 23.8564 20.2404 24.1083 19.9438 23.9522L12.785 20.1884C12.6671 20.1266 12.5266 20.1266 12.4086 20.1884L5.24987 23.9522C4.95328 24.1079 4.60668 23.8564 4.66317 23.5262L6.03049 15.5548C6.05301 15.4234 6.00949 15.2898 5.91406 15.1971L0.122622 9.55185C-0.117479 9.31785 0.0149776 8.91056 0.346691 8.86208L8.35057 7.69899C8.48227 7.6799 8.59602 7.59707 8.6548 7.47797L12.2342 0.22531C12.3823 -0.0751032 12.811 -0.0751032 12.9591 0.22531H12.9594Z" fill="#F3CC30"/><path d="M4.82045 22.6093L4.66318 23.5266C4.60668 23.8568 4.95328 24.1087 5.24988 23.9526L12.4086 20.1888C12.5266 20.127 12.6671 20.127 12.785 20.1888L19.9438 23.9526C20.2404 24.1087 20.587 23.8568 20.5305 23.5266L19.1632 15.5551C19.1406 15.4238 19.1841 15.2902 19.2796 15.1975L25.071 9.55222C25.3111 9.31822 25.1787 8.91093 24.847 8.86245L22.1661 8.47272C17.8302 16.2541 11.1906 20.351 4.82045 22.6093Z" fill="#EDBD31"/><circle cx="9.84845" cy="10.7646" r="1.2215" fill="#785D0F"/><circle cx="15.3452" cy="10.7646" r="1.2215" fill="#785D0F"/></svg>',
    "2star":
      '<svg width="26" height="24" viewBox="0 0 26 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M13.1616 0.22531L16.741 7.47797C16.7998 7.59745 16.9135 7.6799 17.0452 7.69899L25.0491 8.86208C25.3808 8.91018 25.5133 9.31785 25.2732 9.55185L19.4817 15.1971C19.3863 15.2898 19.3428 15.4238 19.3653 15.5548L20.7326 23.5262C20.7891 23.8564 20.4425 24.1083 20.1459 23.9522L12.9872 20.1884C12.8692 20.1266 12.7287 20.1266 12.6108 20.1884L5.45202 23.9522C5.15542 24.1079 4.80882 23.8564 4.86532 23.5262L6.23263 15.5548C6.25516 15.4234 6.21164 15.2898 6.11621 15.1971L0.324771 9.55185C0.0846695 9.31785 0.217126 8.91056 0.54884 8.86208L8.55272 7.69899C8.68441 7.6799 8.79817 7.59707 8.85695 7.47797L12.4363 0.22531C12.5844 -0.0751032 13.0131 -0.0751032 13.1612 0.22531H13.1616Z" fill="#F3CC30"/><path d="M5.02259 22.6093L4.86533 23.5266C4.80883 23.8568 5.15543 24.1087 5.45203 23.9526L12.6108 20.1888C12.7287 20.127 12.8692 20.127 12.9872 20.1888L20.1459 23.9526C20.4425 24.1087 20.7891 23.8568 20.7326 23.5266L19.3653 15.5551C19.3428 15.4238 19.3863 15.2902 19.4817 15.1975L25.2732 9.55222C25.5133 9.31822 25.3808 8.91093 25.0491 8.86245L22.3683 8.47272C18.0323 16.2541 11.3927 20.351 5.02259 22.6093Z" fill="#EDBD31"/><circle cx="10.0506" cy="10.7646" r="1.2215" fill="#785D0F"/><circle cx="15.5473" cy="10.7646" r="1.2215" fill="#785D0F"/><path d="M10.0314 15.7145C10.9666 14.7157 13.5623 13.742 15.7381 15.7145" stroke="#785D0F" stroke-width="0.763438" stroke-linecap="round"/></svg>',
    "3star":
      '<svg width="26" height="24" viewBox="0 0 26 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M13.7604 0.22531L17.3397 7.47797C17.3985 7.59745 17.5123 7.6799 17.644 7.69899L25.6478 8.86208C25.9796 8.91018 26.112 9.31785 25.8719 9.55185L20.0805 15.1971C19.985 15.2898 19.9415 15.4238 19.964 15.5548L21.3314 23.5262C21.3879 23.8564 21.0413 24.1083 20.7447 23.9522L13.5859 20.1884C13.468 20.1266 13.3275 20.1266 13.2095 20.1884L6.05077 23.9522C5.75418 24.1079 5.40758 23.8564 5.46407 23.5262L6.83139 15.5548C6.85391 15.4234 6.81039 15.2898 6.71496 15.1971L0.923526 9.55185C0.683424 9.31785 0.815881 8.91056 1.14759 8.86208L9.15148 7.69899C9.28317 7.6799 9.39692 7.59707 9.45571 7.47797L13.0351 0.22531C13.1832 -0.0751032 13.6119 -0.0751032 13.76 0.22531H13.7604Z" fill="#F3CC30"/><path d="M5.62135 22.6093L5.46408 23.5266C5.40759 23.8568 5.75419 24.1087 6.05078 23.9526L13.2095 20.1888C13.3275 20.127 13.468 20.127 13.5859 20.1888L20.7447 23.9526C21.0413 24.1087 21.3879 23.8568 21.3314 23.5266L19.9641 15.5551C19.9415 15.4238 19.9851 15.2902 20.0805 15.1975L25.8719 9.55222C26.112 9.31822 25.9796 8.91093 25.6479 8.86245L22.967 8.47272C18.6311 16.2541 11.9915 20.351 5.62135 22.6093Z" fill="#EDBD31"/><circle cx="10.6494" cy="10.7646" r="1.2215" fill="#785D0F"/><circle cx="16.1461" cy="10.7646" r="1.2215" fill="#785D0F"/><path d="M10.8019 15.2307H16.0124" stroke="#785D0F" stroke-width="0.763438" stroke-linecap="round"/></svg>',
    "4star":
      '<svg width="26" height="24" viewBox="0 0 26 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M13.6489 0.22531L17.2283 7.47797C17.2871 7.59745 17.4008 7.6799 17.5325 7.69899L25.5364 8.86208C25.8681 8.91018 26.0006 9.31785 25.7605 9.55185L19.969 15.1971C19.8736 15.2898 19.8301 15.4238 19.8526 15.5548L21.2199 23.5262C21.2764 23.8564 20.9298 24.1083 20.6332 23.9522L13.4745 20.1884C13.3565 20.1266 13.216 20.1266 13.0981 20.1884L5.93932 23.9522C5.64273 24.1079 5.29613 23.8564 5.35262 23.5262L6.71994 15.5548C6.74246 15.4234 6.69894 15.2898 6.60351 15.1971L0.812075 9.55185C0.571974 9.31785 0.704431 8.91056 1.03614 8.86208L9.04003 7.69899C9.17172 7.6799 9.28547 7.59707 9.34426 7.47797L12.9236 0.22531C13.0717 -0.0751032 13.5004 -0.0751032 13.6485 0.22531H13.6489Z" fill="#F3CC30"/><path d="M5.5099 22.6093L5.35263 23.5266C5.29614 23.8568 5.64274 24.1087 5.93933 23.9526L13.0981 20.1888C13.216 20.127 13.3565 20.127 13.4745 20.1888L20.6332 23.9526C20.9298 24.1087 21.2764 23.8568 21.2199 23.5266L19.8526 15.5551C19.8301 15.4238 19.8736 15.2902 19.969 15.1975L25.7605 9.55222C26.0006 9.31822 25.8681 8.91093 25.5364 8.86245L22.8556 8.47272C18.5196 16.2541 11.88 20.351 5.5099 22.6093Z" fill="#EDBD31"/><circle cx="10.5379" cy="10.7646" r="1.2215" fill="#785D0F"/><circle cx="16.0346" cy="10.7646" r="1.2215" fill="#785D0F"/><path d="M16.2254 14.5718C15.2902 15.5706 12.6945 16.5443 10.5187 14.5718" stroke="#785D0F" stroke-width="0.763438" stroke-linecap="round"/></svg>',
    "5star":
      '<svg width="24" height="23" viewBox="0 0 24 23" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12.3455 0.214635L15.7552 7.12368C15.8112 7.23749 15.9196 7.31604 16.0451 7.33422L23.6697 8.44221C23.9857 8.48803 24.1119 8.87639 23.8832 9.0993L18.3661 14.4771C18.2752 14.5654 18.2338 14.6931 18.2552 14.8178L19.5578 22.4116C19.6116 22.7261 19.2814 22.9661 18.9989 22.8174L12.1793 19.232C12.0669 19.173 11.9331 19.173 11.8207 19.232L5.00114 22.8174C4.7186 22.9657 4.38842 22.7261 4.44224 22.4116L5.74477 14.8178C5.76623 14.6927 5.72477 14.5654 5.63386 14.4771L0.116813 9.0993C-0.111913 8.87639 0.0142679 8.48839 0.330266 8.44221L7.95494 7.33422C8.08039 7.31604 8.18875 7.23713 8.24475 7.12368L11.6545 0.214635C11.7956 -0.0715449 12.204 -0.0715449 12.3451 0.214635H12.3455Z" fill="#F3CC30"/><path d="M4.59206 21.5381L4.44225 22.4119C4.38843 22.7265 4.71861 22.9665 5.00115 22.8177L11.8207 19.2323C11.9331 19.1734 12.0669 19.1734 12.1793 19.2323L18.9989 22.8177C19.2814 22.9665 19.6116 22.7265 19.5578 22.4119L18.2552 14.8181C18.2338 14.6931 18.2752 14.5658 18.3661 14.4774L23.8832 9.09965C24.1119 8.87674 23.9857 8.48874 23.6697 8.44256L21.1159 8.07129C16.9854 15.484 10.6604 19.3868 4.59206 21.5381Z" fill="#EDBD31"/><circle cx="9.38183" cy="10.2546" r="1.16363" fill="#785D0F"/><circle cx="14.6182" cy="10.2546" r="1.16363" fill="#785D0F"/><path d="M9.50203 13.4521C11.4693 16.8655 13.7588 15.2634 14.7007 13.4399C14.7494 13.3458 14.6803 13.2364 14.5743 13.2364L9.62366 13.2364C9.51355 13.2364 9.44704 13.3567 9.50203 13.4521Z" stroke="#785D0F" stroke-width="0.727268" stroke-linecap="round"/></svg>',
  },
  unfilled:
    '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="23" viewBox="0 0 24 23" fill="none"><g clip-path="url(#clip0_289_3514)"><path d="M12 1.77L14.86 7.56C15.06 7.97 15.45 8.25 15.9 8.32L22.29 9.25L17.67 13.76C17.34 14.08 17.19 14.54 17.27 14.99L18.36 21.36L12.64 18.35C12.2447 18.1523 11.7513 18.1235 11.36 18.35L5.64001 21.36L6.73001 14.99C6.81001 14.54 6.66001 14.08 6.33001 13.76L1.71001 9.25L8.10001 8.32C8.55001 8.25 8.94001 7.97 9.14001 7.56L12 1.77ZM11.65 0.21L8.24001 7.12C8.18001 7.23 8.08001 7.31 7.95001 7.33L0.330006 8.44C0.0100064 8.49 -0.109994 8.87 0.120006 9.1L5.64001 14.48C5.73001 14.57 5.77001 14.7 5.75001 14.82L4.45001 22.41C4.40302 22.7037 4.74752 22.985 5.01001 22.81L11.83 19.22C11.95 19.16 12.07 19.16 12.19 19.22L19.01 22.81C19.07 22.84 19.13 22.86 19.19 22.86C19.41 22.86 19.61 22.66 19.57 22.41L18.27 14.82C18.25 14.7 18.29 14.57 18.38 14.48L23.9 9.1C24.13 8.88 24 8.49 23.69 8.44L16.07 7.33C15.94 7.31 15.84 7.23 15.78 7.12L12.35 0.21C12.21 -0.07 11.81 -0.07 11.65 0.21Z" fill="#6E6E6E"/></g><defs><clipPath id="clip0_289_3514"><rect width="24" height="22.86" fill="white"/></clipPath></defs></svg>',
};

const ratingText = {
  1: {
    stars: 1,
    heading: "Very Bad",
    color: "#FC790D",
    subHeading: "What went wrong?",
  },
  2: {
    stars: 2,
    heading: "Bad",
    color: "#FC790D",
    subHeading: "What went wrong?",
  },
  3: {
    stars: 3,
    heading: "Average",
    color: "#FC790D",
    subHeading: "What went wrong?",
  },
  4: {
    stars: 4,
    heading: "Good",
    color: "#559B09",
    subHeading: "Thank you for your appreciation",
  },
  5: {
    stars: 5,
    heading: "Excellent",
    color: "#559B09",
    subHeading:
      'Rate us <span style="font-weight: bold;">5 star</span> on play store',
  },
};

const WIDGET_VERSION = window.PARAM_WIDGET_VERSION || "2.0";
const THANKYOU_ID = window.PARAM_THANKYOU_ID;
const APP = window.PARAM_APP || "";

const TRACK_EVENT_NAME = window.PARAM_TRACK_EVENT_NAME || "Rating Given";
const TRACK_EVENT_NAME_SURVEY =
  window.PARAM_TRACK_EVENT_NAME_SURVEY || "Rating Given - Deeper Responses";

const GLOBAL_TIMEOUT = window.PARAM_GLOBAL_TIMEOUT || 20000;

const APP_ICON =
  window.PARAM_APP_ICON ||
  "https://play-lh.googleusercontent.com/hqBIT_YHJYDbNtsiL79ai6CQtgblYjT7bAVrPO0idwyHOKdZUAD_hzTGqniM6l6rbRY=s360-rw";
const STORE_ICON =
  window.PARAM_STORE_ICON ||
  "https://rocket.ixigo.com/gplay-nps/googleplay-cropped.svg";

const URL_HELP = window.PARAM_URL_HELP || "https://ixtr.app.link/help";
const URL_STORE =
  window.PARAM_URL_STORE ||
  "https://play.google.com/store/apps/details?id=com.ixigo.train.ixitrain";
const REDIRECT_TIME = window.PARAM_REDIRECT_TIME || 1000;
const REDIRECT_5 =
  window.PARAM_REDIRECT_5 !== undefined ? window.PARAM_REDIRECT_5 : true;
const REDIRECT_4 =
  window.PARAM_REDIRECT_4 !== undefined ? window.PARAM_REDIRECT_4 : false;

const MICROSURVEY = window.PARAM_MICROSURVEY || [];
const MICROSURVEY_HEADING = window.PARAM_MICROSURVEY_HEADING;
const OTHER_SURVEY_URL = window.PARAM_OTHER_SURVEY_URL;

var lastRating = undefined;
var DEFAULT_RATING = window.DEFAULT_RATING;
var hasBeenRedirected = false;
let lastSelectedOptionId = "";

window.closeModal = function () {
  document.location.href = "wzrk://thisleadstonowhere";
};

setTimeout(function () {
  document.location.href = "wzrk://thisleadstonowhere";
}, GLOBAL_TIMEOUT);

const resetDefaultTextboxStyles = () => {
  const optionalText = document.getElementById("optionalText");
  const errorText = document.getElementById("error");
  optionalText.classList.remove("optionalTextAlert");
  errorText.style.display = "none";
};

var appendButton = function (container, buttonLabel, buttonId) {
  var buttonEl = document.createElement("button");
  buttonEl.className = "surveyButton" + (APP ? "_" + APP : "");
  buttonEl.type = "button";
  buttonEl.id = buttonId;
  buttonEl.innerText = buttonLabel;
  buttonEl.label = buttonLabel;
  container.appendChild(buttonEl);
  buttonEl.addEventListener("click", function (event) {
    event.preventDefault();
    const submitButton = document.getElementById("submitButton");
    submitButton.classList.remove("disabledButton");
    resetDefaultTextboxStyles();
    if (lastSelectedOptionId) {
      const lastSelectedBtn = document.getElementById(lastSelectedOptionId);
      lastSelectedBtn.classList.remove("surveyButton__selected");
    }
    lastSelectedOptionId = buttonId;
    const btnElement = document.getElementById(buttonId);
    btnElement.classList.add("surveyButton__selected");
  });
  return buttonEl;
};

var trackEvent = function (eventName, eventProps, profileProps) {
  try {
    var newProps = Object.assign(eventProps, window.IXIGO_EXTRA_CONTEXT);
    console.log("Tracking event", eventName, newProps, profileProps);
    eventProps.widgetVersion = WIDGET_VERSION;
    // ANDROID EVENT...
    if (window.CleverTap) {
      CleverTap.pushEvent(eventName, JSON.stringify(newProps));
      if (profileProps) {
        CleverTap.pushProfile(JSON.stringify(profileProps));
      }
      // IOS EVENT...
    } else if (
      window.webkit &&
      window.webkit.messageHandlers &&
      window.webkit.messageHandlers.clevertap
    ) {
      window.webkit.messageHandlers.clevertap.postMessage({
        action: "recordEventWithProps",
        event: eventName,
        props: newProps,
      });
      if (profileProps) {
        window.webkit.messageHandlers.clevertap.postMessage({
          action: "profilePush",
          properties: profileProps,
        });
      }
    }
  } catch (e) {}
};

var trackRating = function (rating, comment) {
  lastRating = rating;
  trackEvent(
    TRACK_EVENT_NAME,
    rating > 0 ? { rating: rating, comment } : { comment },
    rating > 0
      ? {
          rating,
          lastRatingDate: new Date(),
          lastRatingWidget: WIDGET_VERSION,
        }
      : undefined
  );
};

var show = function (elem) {
  if (elem) {
    elem.style.display = "block";
  }
};
var hide = function (elem) {
  if (elem) {
    elem.style.display = "none";
  }
};
var toggle = function (elem) {
  if (elem) {
    if (window.getComputedStyle(elem).display === "block") {
      hide(elem);
      return;
    }
    show(elem);
  }
};

var getRating = function () {
  let val = 0;
  if (document.getElementById("star1").checked) {
    val = 1;
  } else if (document.getElementById("star2").checked) {
    val = 2;
  } else if (document.getElementById("star3").checked) {
    val = 3;
  } else if (document.getElementById("star4").checked) {
    val = 4;
  } else if (document.getElementById("star5").checked) {
    val = 5;
  }
  return val;
};

var updateRating = function (e) {
  var displayedStars = [];
  var rating = getRating();
  for (var i = 0; i < 5; i++) {
    if (i <= rating - 1) {
      displayedStars.push("filled");
    } else {
      displayedStars.push("unfilled");
    }
  }
  var array = ["star1", "star2", "star3", "star4", "star5"];
  for (var i = 0; i < array.length; i++) {
    var lastFilled = displayedStars.lastIndexOf("filled");
    var star = document.querySelector(`label[for='${array[i]}']`).firstChild;
    var heading = document.getElementById("heading");
    var subHeading = document.getElementById("sub-heading");
    star.classList.remove("selected");
    !star.classList.contains("img") && star.classList.add("img");
    if (i < lastFilled) {
      star.innerHTML = assets.filled.solid;
    }
    if (i === lastFilled) {
      star.innerHTML = `${assets.filled[`${i + 1}star`]}`;
      heading.innerHTML = ratingText[lastFilled + 1].heading;
      heading.style.color = ratingText[lastFilled + 1].color;
      subHeading.innerHTML = ratingText[lastFilled + 1].subHeading;
      star.classList.add("selected");
      star.classList.remove("img");
    }
    if (i > lastFilled) {
      star.innerHTML = assets.unfilled;
    }
  }
  const oldSurveyContainer = document.getElementById("surveyContainer");
  if (oldSurveyContainer) {
    oldSurveyContainer.remove();
    lastSelectedOptionId = "";
    resetDefaultTextboxStyles();
  }

  if (rating <= 3) {
    const parent = document.getElementById("rateform");
    const surveyContainer = document.createElement("div");
    surveyContainer.innerHTML = "";
    surveyContainer.id = "surveyContainer";
    let MICROSURVEY_COPY = [...MICROSURVEY];
    const lastItem = MICROSURVEY_COPY.pop();
    const shuffledArray = MICROSURVEY_COPY.sort((a, b) => 0.5 - Math.random());
    let i = 0;
    for (i = 0; i < shuffledArray.length; i++) {
      appendButton(surveyContainer, shuffledArray[i], "survey_button_" + i);
    }
    appendButton(surveyContainer, lastItem, "survey_button_" + i);
    parent.appendChild(surveyContainer);
  }
};

(function () {
  try {
    console.log("Rater... INIT");
    if (DEFAULT_RATING === 5) {
      var submitButton = document.getElementById("submitButton");
      submitButton.classList.remove("disabledButton");
    }
    var displayedStars = [];
    for (var i = 0; i < 5; i++) {
      if (i <= DEFAULT_RATING - 1) {
        displayedStars.push("filled");
      } else {
        displayedStars.push("unfilled");
      }
    }
    var array = ["star1", "star2", "star3", "star4", "star5"];
    for (var i = 0; i < array.length; i++) {
      var starInput = document.getElementById(array[i]);
      starInput.addEventListener("click", function (event) {
        updateRating(event);
      });
      var lastFilled = displayedStars.lastIndexOf("filled");
      var star = document.querySelector(`label[for='${array[i]}']`).firstChild;
      var heading = document.getElementById("heading");
      var subHeading = document.getElementById("sub-heading");
      if (i < lastFilled) {
        star.innerHTML = assets.filled.solid;
        starInput.checked = true;
      }
      if (i === lastFilled) {
        star.innerHTML = `${assets.filled[`${i + 1}star`]}`;
        starInput.checked = true;
        heading.innerHTML = ratingText[lastFilled + 1].heading;
        heading.style.color = ratingText[lastFilled + 1].color;
        subHeading.innerHTML = ratingText[lastFilled + 1].subHeading;
        star.classList.remove("img");
        star.classList.add("selected");
      }
      if (i > lastFilled) {
        star.innerHTML = assets.unfilled;
      }
    }

    var thankyouBox;

    if (THANKYOU_ID) {
      thankyouBox = document.getElementById(THANKYOU_ID);
    }

    var ctName = document.getElementById("title");

    var avatarName = document.getElementById("user-avatar-name");

    var ctNumberMatch = ctName.textContent.match(/\d+/g);
    window.IXIGO_EXTRA_CONTEXT = window.IXIGO_EXTRA_CONTEXT || {};

    console.log("IXIGO_EXTRA_CONTEXT", window.IXIGO_EXTRA_CONTEXT);

    var fullName = ctName.textContent.split(",")[0];
    avatarName.textContent = fullName;

    document.getElementById(
      "user-avatar"
    ).src = `https://avatar.oxro.io/avatar.svg?name=${encodeURI(
      fullName
    )}&caps=1`;

    document.getElementById("imageRating").src = APP_ICON;
    document.getElementById("play-logo").src = STORE_ICON;

    var commentBox = document.getElementById("commentBox");

    document
      .getElementById("submitButton")
      .addEventListener("click", function (e) {
        if (this.classList.value) {
          return;
        } else {
          trackRating(getRating(), optionalText.value || "");
          if (getRating() === 5 && !hasBeenRedirected) {
            show(document.getElementById("success-box-questions"));
            if (REDIRECT_5) {
              hide(commentBox);
              setTimeout(function () {
                document.location.href = URL_STORE;
                hasBeenRedirected = true;
              }, REDIRECT_TIME); //will call the function after 1 secs.
            } else {
              show(commentBox);
            }
          } else if (getRating() <= 3) {
            const optionalText = document.getElementById("optionalText");
            const errorText = document.getElementById("error");
            const selectedDeeperRes =
              document.getElementById(lastSelectedOptionId);
            if (lastSelectedOptionId) {
              if (selectedDeeperRes.innerText.toLowerCase() === "other") {
                if (optionalText.value === "") {
                  optionalText.classList.add("optionalTextAlert");
                  errorText.style.display = "block";
                  return;
                } else {
                  trackEvent(
                    TRACK_EVENT_NAME_SURVEY,
                    {
                      comment: optionalText.value,
                      lastSelectedOptionId,
                      lastRating,
                    },
                    undefined
                  );
                }
              } else {
                trackEvent(
                  TRACK_EVENT_NAME_SURVEY,
                  {
                    comment: selectedDeeperRes.innerText,
                    lastSelectedOptionId,
                    lastRating,
                  },
                  undefined
                );
              }
            }
            show(document.getElementById("success-box-questions"));
          } else {
            show(document.getElementById("success-box-questions"));
            setTimeout(function () {
              document.location.href = "wzrk://thisleadstonowhere"; // Hack to close the modal
            }, 3000);
          }
          show(document.getElementById("success-box"));
          hide(document.getElementById("middle-block"));
        }
      });

    document
      .getElementById("notnowButton")
      .addEventListener("click", function (e) {
        trackRating(0, "NOT_NOW_CLICK");
        document.location.href = "wzrk://thisleadstonowhere"; // Hack to close the modal
      });

    for (var i = 0; i < array.length; i++) {
      document.getElementById(array[i]).addEventListener(
        "click",
        function (e) {
          this.checked = true;
          console.log("Rater... CLICK");
          var submitButton = document.getElementById("submitButton");
          submitButton.classList.remove("disabledButton");
          let val = getRating();
          if (val === 5) {
            if (REDIRECT_5) {
              hide(commentBox);
              trackRating(val, "5 Stars Autoredirect");
              setTimeout(function () {
                document.location.href = URL_STORE;
                hasBeenRedirected = true;
              }, REDIRECT_TIME); //will call the function after 1 secs.
            } else {
              show(commentBox);
            }
          } else if (val === 4) {
            if (REDIRECT_4) {
              hide(commentBox);
              trackRating(val, "4 Stars Autoredirect");
              setTimeout(function () {
                document.location.href = URL_STORE;
              }, REDIRECT_TIME);
            } else {
              show(commentBox);
            }
          } else {
            show(commentBox);
          }
        },
        false
      );
    }

    console.log("Rater... END");
  } catch (exception) {
    console.log(exception);
    document.location.href = "wzrk://thisleadstonowhere"; // Hack to close the modal
  }
})();
